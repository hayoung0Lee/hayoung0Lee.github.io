{"componentChunkName":"component---src-templates-blog-template-js","path":"/project/next/how-pages-work","result":{"data":{"markdownRemark":{"html":"<h3>Next.js 의 Page는 어떻게 동작하나</h3>\n<p><a href=\"https://nextjs.org/docs/basic-features/pages\">Next.js Pages 문서</a></p>\n<p>여기를 읽어보면 <code class=\"language-text\">page는 React Component다. .js, .jsx, .ts, .tsx로 부터 export된</code>. 그리고 얘는 <code class=\"language-text\">pages directory</code>내에 있다. 만약 pages 내에 <code class=\"language-text\">about.js</code>가 있다면 이 곳에 <code class=\"language-text\">/about</code>으로 접근한다.</p>\n<p>그리고 Dynamic route도 지원하는데, <code class=\"language-text\">pages/posts/[id].js</code> 이렇게 파일을 만들면 <code class=\"language-text\">posts/1</code> 이런식으로 접근이 된다.</p>\n<h3>Pre-rendering</h3>\n<p>Next.js는 기본적으로 모든 페이지를 pre-rendering 한다.</p>\n<p><a href=\"https://developers.google.com/web/updates/2019/02/rendering-on-the-web\">여기서 글을 읽었을때</a> pre-rendering의 개념이 잘 와닿지 않아서 제대로 정리를 해보려고 한다.</p>\n<blockquote>\n<p>React users may be familiar with Gatsby, Next.js static export or Navi - all of these make it convenient to author using components. However, it’s important to understand the difference between static rendering and prerendering: static rendered pages are interactive without the need to execute much client-side JS, whereas prerendering improves the First Paint or First Contentful Paint of a Single Page Application that must be booted on the client in order for pages to be truly interactive.</p>\n</blockquote>\n<blockquote>\n<p>If you’re unsure whether a given solution is static rendering or prerendering, try this test: disable JavaScript and load the created web pages. For statically rendered pages, most of the functionality will still exist without JavaScript enabled. For prerendered pages, there may still be some basic functionality like links, but most of the page will be inert.</p>\n</blockquote>\n<blockquote>\n<p>Another useful test is to slow your network down using Chrome DevTools, and observe how much JavaScript has been downloaded before a page becomes interactive. Prerendering generally requires more JavaScript to get interactive, and that JavaScript tends to be more complex than the Progressive Enhancement approach used by static rendering.</p>\n</blockquote>\n<p>솔직히 사람들이 용어 그냥 섞어 쓰는 것 같다. Pre-render가 static generation만을 의미하는게 아니다, 뭐 요정도 느낌 잡으면 되지 않을까 싶다.</p>\n<ul>\n<li>\n<p>Next.js는 두가지 형태의 pre-render를 제공한다. <code class=\"language-text\">Static Generation</code> 과 <code class=\"language-text\">Server-side Rendering</code></p>\n<ul>\n<li><code class=\"language-text\">Static Generation(Recommended)</code>: 빌드타임에 html이 만들어지고, 각 요청마다 재사용</li>\n<li><code class=\"language-text\">Server-side rendering</code>: 각 요청마다 html을 생성</li>\n</ul>\n</li>\n<li>Next.js는 <code class=\"language-text\">Static Generation</code>를 <code class=\"language-text\">Server-side Rendering</code>보다 우선해서 쓰기를 원한다. Static하게 만들어진건 CDN에 올리기도 쉽기 때문이다. 그래도 경우에 따라 Server-side rendering이 유일한 방법일수 있다. 그리고 Client-side rendering도 앞의 두가지 방법과 섞어서 쓸수 있다.</li>\n</ul>\n<h3>Static Generation(Recommended)</h3>\n<p>Page가 Static Geration 된단 말은 <code class=\"language-text\">next build</code>할때 만들어진단 소리다. 이때는 Data를 <code class=\"language-text\">포함 할 수도, 안할 수도 있다</code>.</p>\n<ul>\n<li>\n<p>Data가 있는 경우</p>\n<ul>\n<li><code class=\"language-text\">content</code>데이터를 가져와야할 때: <code class=\"language-text\">getStaticProps</code></li>\n<li><code class=\"language-text\">paths</code>가 외부에 의존하고 있을 때: <code class=\"language-text\">getStaticPaths</code></li>\n</ul>\n</li>\n</ul>\n<h4>getStaticProps를 사용해보자</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Post를 Fetch 어디선가 해와야한다. pre-rendering하기 위해서</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Blog</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> post <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ul<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>posts<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Blog<span class=\"token punctuation\">;</span></code></pre></div>\n<p>이걸 보자... Post를 어디선가 가지곤 와야 pre-rendering을 할 수 있을 것이다. 그래서 Next.js는 <code class=\"language-text\">export async function getStaticProps() {</code> 이렇게 지원하고 있다. 빌드타임에 얘를 불러서 page 컴포넌트에 props로 넘겨줄수 있도록 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 실제 코드</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticProps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 외부에 데이터를 요청한다.</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://.../posts\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 이렇게 넘겨주면, posts를 props로 컴포넌트에 넘겨준다</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      posts<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 각 페이지에 데이터를 넘겨줄 수 있다!</p>\n<h4>getStaticPaths를 사용해보자</h4>\n<p>Next.js는 <strong>dynamic routes</strong> 를 기반으로 pages를 생성할 수 있다고 하는데 이말의 뜻은 <code class=\"language-text\">pages/posts/[id].js</code>라는 이름의 파일을 만들고 <code class=\"language-text\">posts/id</code> 이런 path로 page를 만들수있다는 것이다.\n그런데 어떤 <code class=\"language-text\">id</code>를 사용하는지가 외부데이터에 의존하고 있을 수 있다.</p>\n<p>예를들자면 db에 작성한 Post가 하나있는데, 얘만 가지고 빌드타임에 만들고 싶을 수 있다. 그리고 나중에 두번째 포스트가 추가되면 얘가지고도 빌드하고 싶고. 그래서 <code class=\"language-text\">path가 외부에 의존한다</code>는 말은 대략 외부에 어떤 포스트가 있는지에 따라서 path가 결정된다는 말이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 빌드타임에 얘를 불러서 post id를 가져와서 path를 생성한다.</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticPaths</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Call an external API endpoint to get posts</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://.../posts\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// post의 id에 따른 path를 생성한다.</span>\n  <span class=\"token keyword\">const</span> paths <span class=\"token operator\">=</span> posts<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/posts/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>post<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 요 path들만 가지고 빌드</span>\n  <span class=\"token comment\">// { fallback: false } 다른건 다 404에러 띄우라는것</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> paths<span class=\"token punctuation\">,</span> fallback<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이건 이렇게 써서 어떤 path를 빌드타임에 만들어야할지를 알려주는 용도이다.</p>\n<p>이러고나서 <code class=\"language-text\">getStaticProps</code>에서 이 path를 <code class=\"language-text\">params</code>로 받는다</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 다시한번, 얘는 빌드타임에 불린다.</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getStaticProps</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> params <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// params에 포스트의 id에 접근한다.</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://.../posts/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>params<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 이전이랑 똑같이 Post데이터를 넘겨준다</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> post <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이때 params.id로 path에 접근할 수 있는 이유는 file명이 <code class=\"language-text\">pages/posts/[id].js</code>이기 때문이다. <code class=\"language-text\">pages/posts/[postId]/[commentId]</code>이면 params.postId, params.commentId로 해당 parameter에 접근할 수 있따.</p>\n<h3>Server-side Rendering</h3>\n<p>SSR을 하면 request마다 html이 생성된다. 만약에 이 페이지가 자주 업데이트되는 데이터가 필요하다면 <code class=\"language-text\">getServerSideProps</code>를 통해서 이를 해결한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// request마다 호출된다</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getServerSideProps</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 외부 api를 호출한다</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://.../data</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// data를 props를 통해서 넘겨준다</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>사용버만 보면 <code class=\"language-text\">getStaticProps</code>랑 비슷한데, 가장 큰 차이점은 <code class=\"language-text\">getServerSideProps</code>는 매번 호출 된다는 것이다.</p>\n<h3>Next가 내부에서 어떻게 동작하는지 궁금해서 까본다.</h3>\n<p>까볼때, 우선 prettier설정을 바꿔서(<a href=\"https://github.com/prettier/prettier-vscode/issues/1081\">참고</a>) <code class=\"language-text\">npm run dev</code> 나 <code class=\"language-text\">npm run start</code>를 했을때의 동작을 본다.</p>\n<ol>\n<li>우선 npm run dev라고 입력하면 <code class=\"language-text\">package.json</code>에서 <code class=\"language-text\">next dev</code>가 실행된다. 이때 next는 path에 등록되있어서 바로 사용할 수 있다.</li>\n<li>node<em>modules내의 next 폴더에 가면 아래의 내용이 있다.\n&#x3C;img src=\"../memo-next/next</em>modules.png\" alt=\"next module\" onerror=\"this.src='<a href=\"https://raw.githubusercontent.com/hayoung0Lee/NextJs-DeepDive-Again/main/memo-next/next_modules.png&#x27;;\">https://raw.githubusercontent.com/hayoung0Lee/NextJs-DeepDive-Again/main/memo-next/next_modules.png';</a>\" /></li>\n</ol>\n<p>여기 최상단에 있는 파일들은 열어보니까 dist에 있는걸 가져와서 exports하고있어서 dist 폴더 내부를 살펴보기로 했다(이렇게 큰 패키지는 어떻게 구성되는지 잘 모르기때문에 일단 느낌대로 따라가고 있다. )</p>\n<ol start=\"3\">\n<li>\n<p>일단 젤처음에 시작되는 next executable이 어떻게 생겼는지를 살펴보려고 한다.</p>\n<img src=\"../memo-next/next_executable.png\" alt=\"next executable\" onerror=\"this.src='https://raw.githubusercontent.com/hayoung0Lee/NextJs-DeepDive-Again/main/memo-next/next_executable.png';\" />\n</li>\n<li>얘는 commands를 실행하는 부분으로 구성되어있다.(default는 dev)</li>\n<li>commands가 있는 부분은 commands에 따라서 아래의 동작을 실행한다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> defaultCommand <span class=\"token operator\">=</span> <span class=\"token string\">\"dev\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> commands <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">build</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">_interopRequireWildcard</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../cli/next-build\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> i<span class=\"token punctuation\">.</span>nextBuild<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">start</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">_interopRequireWildcard</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../cli/next-start\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> i<span class=\"token punctuation\">.</span>nextStart<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">export</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">_interopRequireWildcard</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../cli/next-export\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> i<span class=\"token punctuation\">.</span>nextExport<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">dev</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">_interopRequireWildcard</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../cli/next-dev\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> i<span class=\"token punctuation\">.</span>nextDev<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">telemetry</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">_interopRequireWildcard</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"../cli/next-telemetry\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> i<span class=\"token punctuation\">.</span>nextTelemetry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>각 동작을 저기 안에 두고 여기서 처리를 하는 식으로 구성되어있다. 그외의 부분들은 설정파일이 이상하거나 하는 부분을 처리하는 것 같다.</p>\n<ul>\n<li><code class=\"language-text\">_interopRequireWildcard</code>에 어떤 obj가 넘어가는지 보려고 콘솔에 찍어봣다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">_interopRequireWildcard</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"next의 _interopRequireWildcard\"</span><span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>obj <span class=\"token operator\">&amp;&amp;</span> obj<span class=\"token punctuation\">.</span>__esModule<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<img src=\"../memo-next/interop.png\" alt=\"next executable\" onerror=\"this.src='https://raw.githubusercontent.com/hayoung0Lee/NextJs-DeepDive-Again/main/memo-next/interop.png';\" />\n<p>이렇게 두번나오는데 왜 두번인지는 잘 모르겠다!!! 형태가 다른데, 뭔가 처리할텐데 거기까진 파악이 어렵다.</p>\n<ol start=\"4\">\n<li>next-dev안에 startServer\n이파일은 next dev 했을때 실행되는 부분으로 파악된다.</li>\n</ol>\n<img src=\"../memo-next/next-dev-code.png\" alt=\"next-dev-code\" onerror=\"this.src='https://raw.githubusercontent.com/hayoung0Lee/NextJs-DeepDive-Again/main/memo-next/next-dev-code.png';\" />\n<p>코드에 저렇게 추가해서 진짜 여기까지 와서 실행하는지 한번 봤다.</p>\n<img src=\"../memo-next/next-dev-result.png\" alt=\"next-dev-result\" onerror=\"this.src='https://raw.githubusercontent.com/hayoung0Lee/NextJs-DeepDive-Again/main/memo-next/next-dev-result.png';\" />\n<p>실제로 여기서 실행 중이었다.</p>\n<p>startServer까지 이렇게 도달하는구나! Port가 사용중이다이런에러도 요쪽에서 처리중이었다.</p>\n<ul>\n<li>\n<p>아래는 start-server가 어떻게 생겼는지 본건데 여기서 createServer를 호출하고 있다.\n<img src=\"../memo-next/start-server.png\" alt=\"start-server\" onerror=\"this.src='https://raw.githubusercontent.com/hayoung0Lee/NextJs-DeepDive-Again/main/memo-next/start-server.png';\" /></p>\n<p>이 이상은 더이상 파악이 조금 어려워서 createServer가 있는 부분을 찾아보았다.</p>\n</li>\n<li>CreateServer가 있는곳: <code class=\"language-text\">next/dist/server/next.js</code>\n여기서 CreateServer를 하고 있다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"next create server\"</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> standardEnv <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"production\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>options <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span></code></pre></div>\n<p>이렇게 찍어보면</p>\n<img src=\"../memo-next/createServer.png\" alt=\"createServer\" onerror=\"this.src='https://raw.githubusercontent.com/hayoung0Lee/NextJs-DeepDive-Again/main/memo-next/createServer.png';\" />\n<ol start=\"6\">\n<li>파악하고 싶은것 pages가 어떻게 대강 처리되는지을 앞으로 더 파악하기</li>\n</ol>\n<h3>후기</h3>\n<p>JavaScript로 이런 프레임워크를 만들어내는 사람들은 멋있다.. 그냥 굳이 이렇게 안봐도 되는데, 이런거 만드는 사람들은 어떻게 이렇게 코드를 쓰나 궁금해서 한번 열어보는거다. 한 3년내로 웹에서 그냥 라이브러리 갖다 쓰는 사람말고 이런것도 만들어 낼만한 역량을 갖추었으면!!</p>","frontmatter":{"date":null,"slug":"/project/next/how-pages-work","title":"Next.js 의 Page는 어떻게 동작하나 + 코드 진짜 까보기"}}},"pageContext":{"birthTime":"2021-03-26T13:27:20.452Z","modifiedTime":"2021-03-26T13:27:20.452Z","slug":"/project/next/how-pages-work"}},"staticQueryHashes":["1947816842"]}